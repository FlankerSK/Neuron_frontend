(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a0e90ce"],{5918:function(e,t,s){"use strict";var n=s("8d38"),a=s.n(n);a.a},"8d38":function(e,t,s){},"9b9f":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg"},[s("div",{staticClass:"customer"},[s("div",{staticClass:"title"},[e._v(e._s(e.customerTable.title))]),s("el-divider"),s("el-form",{ref:"customerForm",staticClass:"questions",attrs:{model:e.customerTable,"label-position":"top"}},[e._l(e.customerTable.question_answers,(function(t,n){return s("div",{key:n},[0!==n?s("el-divider"):e._e(),s("el-form-item",{staticStyle:{"text-align":"left"},attrs:{prop:"question_answers."+n+".answers",rules:e.rules[t.question.type]}},[s("span",{staticClass:"questionTitle",attrs:{slot:"label"},slot:"label"},[s("el-tag",[e._v(e._s(e.questionTypeMap[t.question.type]))]),e._v(" "+e._s(t.question.title)+" ")],1),"FILL_IN"===t.question.type?s("el-input",{staticStyle:{width:"80%"},attrs:{type:"textarea",size:"medium",rows:"4",disabled:!e.active},model:{value:t.answers,callback:function(s){e.$set(t,"answers",s)},expression:"qa.answers"}}):"SINGLE_ANSWER_MULTIPLE_CHOICE"===t.question.type?s("el-radio-group",{model:{value:t.answers[0],callback:function(s){e.$set(t.answers,0,s)},expression:"qa.answers[0]"}},e._l(t.question.options,(function(t,n){return s("div",{key:n,staticStyle:{"margin-bottom":"10px"}},[e._v(" "+e._s(t.value)+" "),s("el-radio",{attrs:{label:t.value,border:"",disabled:!e.active}},[e._v(" "+e._s(t.value)+" ")])],1)})),0):"MULTIPLE_ANSWER_MULTIPLE_CHOICE"===t.question.type?s("el-checkbox-group",{model:{value:t.answers,callback:function(s){e.$set(t,"answers",s)},expression:"qa.answers"}},e._l(t.question.options,(function(t,n){return s("div",{key:n,staticStyle:{"margin-bottom":"10px"}},[s("el-checkbox",{attrs:{label:t.value,disabled:!e.active,border:""}},[e._v(e._s(t.value))])],1)})),0):"LIST_QUESTION"===t.question.type?s("el-checkbox-group",[e._l(t.answers,(function(n,a){return s("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[s("el-input",{attrs:{type:"text"},model:{value:t.answers[a],callback:function(s){e.$set(t.answers,a,s)},expression:"qa.answers[answerIndex]"}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-close",type:"danger"},on:{click:function(s){return e.removeLine(t.answers,a)}}},[e._v(" 删除 ")])],1)})),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(s){return e.addLine(t.answers)}}},[e._v(" 增加新列 ")])],2):e._e()],1)],1)})),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){return e.saveAnswer()}}},[e._v("保存")]),s("el-button",{attrs:{type:"success",size:"large"},on:{click:function(t){return e.submitAnswer()}}},[e._v("提交")])],1)],2)],1)])},a=[],r=(s("99af"),s("fb6a"),s("a434"),s("b85c")),i=s("5530"),o=s("2f62"),l={name:"Fill",data:function(){var e={SINGLE_ANSWER_MULTIPLE_CHOICE:[{required:!0,trigger:"change",message:"必须且只能选择一个"}],MULTIPLE_ANSWER_MULTIPLE_CHOICE:[{type:"array",required:!0,trigger:"change",message:"至少选一个"}],FILL_IN:[{required:!0,trigger:"blur",message:"输入不可为空"}],LIST_QUESTION:[{required:!0,trigger:"blur",message:"输入不可为空"}]};return{active:!1,rules:e,tableId:-1}},mounted:function(){var e=this;this.tableId=this.$route.params.tableId,this.getFullTable(this.tableId).then((function(t){console.log(t),t&&(e.active=!0)}))},computed:Object(i["a"])({},Object(o["c"])(["customerTable"]),{questionTypeMap:function(){return{FILL_IN:"填空",SINGLE_ANSWER_MULTIPLE_CHOICE:"单选",MULTIPLE_ANSWER_MULTIPLE_CHOICE:"多选",LIST_QUESTION:"列表"}}}),methods:Object(i["a"])({},Object(o["b"])(["getFullTable","saveAnswers","submitAnswers"]),{addLine:function(e){e.push({}),console.log("添加新列")},removeLine:function(e,t){e.splice(t,1)},buildAnswers:function(){var e,t=[],s=Object(r["a"])(this.customerTable.question_answers);try{for(s.s();!(e=s.n()).done;){var n=e.value,a=n.answers;Array.isArray(a)||(a=[a]),t.push({fingerprint:n.question.fingerprint,answers:a})}}catch(i){s.e(i)}finally{s.f()}return t},saveAnswer:function(){var e=this;this.$refs.customerForm.validate((function(t){if(t){console.log("form valid and save answer");var s=e.buildAnswers(),n={tableId:e.tableId,answers:s};e.saveAnswers(n).then((function(t){t?(e.$message.success("保存成功"),e.$router.push({name:"home"})):e.$message.error("保存失败，请检查网络状态")}))}else e.$message.error("采集表不可有空栏")}))},submitAnswer:function(){var e=this,t=function(){function e(e){var t=e.getFullYear(),s=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),a=("0"+e.getHours()).slice(-2),r=("0"+e.getMinutes()).slice(-2),i=("0"+e.getSeconds()).slice(-2);return"".concat(t,"-").concat(s,"-").concat(n,"T").concat(a,":").concat(r,":").concat(i)}return e(new Date)};this.$refs.customerForm.validate((function(s){if(s){console.log("form valid and submit answer");var n=e.buildAnswers(),a={tableId:e.tableId,answers:n};e.saveAnswers(a).then((function(s){if(s){var n={tableId:e.tableId,data:{date:t()}};e.submitAnswers(n).then((function(t){t?(e.$message.success("提交成功"),e.$router.push({name:"home"})):e.$message.error("提交失败，请检查网络状态")}))}else e.$message.error("保存失败，请检查网络状态")}))}else e.$message.error("采集表不可有空栏")}))}})},u=l,c=(s("5918"),s("2877")),d=Object(c["a"])(u,n,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-3a0e90ce.c685af86.js.map